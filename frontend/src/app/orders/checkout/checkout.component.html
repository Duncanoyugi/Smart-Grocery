<div class="checkout-container">
  <!-- Header Section -->
  <div class="checkout-header">
    <h1>Checkout</h1>
    <p>Complete your purchase securely</p>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-section">
    <div class="loading-spinner">ğŸ”„</div>
    <p>Loading checkout...</p>
  </div>

  <!-- Empty Cart Redirect -->
  <div *ngIf="!isLoading && isCartEmpty" class="empty-cart-redirect">
    <div class="empty-icon">ğŸ›’</div>
    <h2>Your cart is empty</h2>
    <p>Please add items to your cart before checking out.</p>
    <button routerLink="/products" class="shop-btn">
      Continue Shopping
    </button>
  </div>

  <!-- Checkout Form -->
  <div *ngIf="!isLoading && !isCartEmpty" class="checkout-content">
    <form [formGroup]="checkoutForm" (ngSubmit)="onSubmit()" class="checkout-form">
      <div class="checkout-layout">
        <!-- Left Column - Forms -->
        <div class="forms-column">
          <!-- Shipping Information -->
          <section class="form-section">
            <h2>ğŸ“¦ Shipping Information</h2>
            
            <div class="form-row">
              <div class="form-group">
                <label for="shippingFirstName">First Name *</label>
                <input
                  type="text"
                  id="shippingFirstName"
                  formControlName="shippingFirstName"
                  [class.error]="shippingFirstName?.invalid && shippingFirstName?.touched"
                  placeholder="Enter your first name"
                >
                <div *ngIf="shippingFirstName?.invalid && shippingFirstName?.touched" class="error-message">
                  <div *ngIf="shippingFirstName?.errors?.['required']">First name is required</div>
                  <div *ngIf="shippingFirstName?.errors?.['minlength']">Minimum 2 characters required</div>
                </div>
              </div>

              <div class="form-group">
                <label for="shippingLastName">Last Name *</label>
                <input
                  type="text"
                  id="shippingLastName"
                  formControlName="shippingLastName"
                  [class.error]="shippingLastName?.invalid && shippingLastName?.touched"
                  placeholder="Enter your last name"
                >
                <div *ngIf="shippingLastName?.invalid && shippingLastName?.touched" class="error-message">
                  <div *ngIf="shippingLastName?.errors?.['required']">Last name is required</div>
                  <div *ngIf="shippingLastName?.errors?.['minlength']">Minimum 2 characters required</div>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="shippingAddress">Shipping Address *</label>
              <input
                type="text"
                id="shippingAddress"
                formControlName="shippingAddress"
                [class.error]="shippingAddress?.invalid && shippingAddress?.touched"
                placeholder="Enter your full address"
              >
              <div *ngIf="shippingAddress?.invalid && shippingAddress?.touched" class="error-message">
                <div *ngIf="shippingAddress?.errors?.['required']">Address is required</div>
                <div *ngIf="shippingAddress?.errors?.['minlength']">Please enter a complete address</div>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="shippingCity">City *</label>
                <input
                  type="text"
                  id="shippingCity"
                  formControlName="shippingCity"
                  [class.error]="shippingCity?.invalid && shippingCity?.touched"
                  placeholder="Enter city"
                >
                <div *ngIf="shippingCity?.invalid && shippingCity?.touched" class="error-message">
                  City is required
                </div>
              </div>

              <div class="form-group">
                <label for="shippingState">State *</label>
                <input
                  type="text"
                  id="shippingState"
                  formControlName="shippingState"
                  [class.error]="shippingState?.invalid && shippingState?.touched"
                  placeholder="Enter state"
                >
                <div *ngIf="shippingState?.invalid && shippingState?.touched" class="error-message">
                  State is required
                </div>
              </div>

              <div class="form-group">
                <label for="shippingZipCode">ZIP Code *</label>
                <input
                  type="text"
                  id="shippingZipCode"
                  formControlName="shippingZipCode"
                  [class.error]="shippingZipCode?.invalid && shippingZipCode?.touched"
                  placeholder="12345"
                >
                <div *ngIf="shippingZipCode?.invalid && shippingZipCode?.touched" class="error-message">
                  <div *ngIf="shippingZipCode?.errors?.['required']">ZIP code is required</div>
                  <div *ngIf="shippingZipCode?.errors?.['pattern']">Please enter a valid ZIP code</div>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="shippingPhone">Phone Number *</label>
              <input
                type="tel"
                id="shippingPhone"
                formControlName="shippingPhone"
                [class.error]="shippingPhone?.invalid && shippingPhone?.touched"
                placeholder="Enter your phone number"
              >
              <div *ngIf="shippingPhone?.invalid && shippingPhone?.touched" class="error-message">
                <div *ngIf="shippingPhone?.errors?.['required']">Phone number is required</div>
                <div *ngIf="shippingPhone?.errors?.['pattern']">Please enter a valid 10-digit phone number</div>
              </div>
            </div>
          </section>

          <!-- Billing Information -->
          <section class="form-section">
            <h2>ğŸ’³ Billing Information</h2>
            
            <div class="checkbox-group">
              <label class="checkbox-label">
                <input
                  type="checkbox"
                  formControlName="sameAsShipping"
                  (change)="onSameAsShippingChange()"
                >
                <span class="checkmark"></span>
                Billing address same as shipping address
              </label>
            </div>

            <div *ngIf="!checkoutForm.get('sameAsShipping')?.value" class="billing-fields">
              <div class="form-row">
                <div class="form-group">
                  <label for="billingFirstName">First Name</label>
                  <input
                    type="text"
                    id="billingFirstName"
                    formControlName="billingFirstName"
                    placeholder="Enter billing first name"
                  >
                </div>

                <div class="form-group">
                  <label for="billingLastName">Last Name</label>
                  <input
                    type="text"
                    id="billingLastName"
                    formControlName="billingLastName"
                    placeholder="Enter billing last name"
                  >
                </div>
              </div>

              <div class="form-group">
                <label for="billingAddress">Billing Address</label>
                <input
                  type="text"
                  id="billingAddress"
                  formControlName="billingAddress"
                  placeholder="Enter billing address"
                >
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="billingCity">City</label>
                  <input
                    type="text"
                    id="billingCity"
                    formControlName="billingCity"
                    placeholder="Enter billing city"
                  >
                </div>

                <div class="form-group">
                  <label for="billingState">State</label>
                  <input
                    type="text"
                    id="billingState"
                    formControlName="billingState"
                    placeholder="Enter billing state"
                  >
                </div>

                <div class="form-group">
                  <label for="billingZipCode">ZIP Code</label>
                  <input
                    type="text"
                    id="billingZipCode"
                    formControlName="billingZipCode"
                    placeholder="Enter billing ZIP code"
                  >
                </div>
              </div>
            </div>
          </section>

          <!-- Payment Information -->
          <section class="form-section">
            <h2>ğŸ’° Payment Method</h2>
            
            <div class="payment-methods">
              <div *ngFor="let method of paymentMethods" class="payment-method">
                <label class="radio-label">
                  <input
                    type="radio"
                    name="paymentMethod"
                    [value]="method"
                    [checked]="selectedPaymentMethod === method"
                    (change)="selectedPaymentMethod = method"
                  >
                  <span class="radiomark"></span>
                  <span class="payment-label">
                    {{ method === 'credit_card' ? 'ğŸ’³ Credit Card' : 
                       method === 'debit_card' ? 'ğŸ’³ Debit Card' : 
                       'ğŸ”µ PayPal' }}
                  </span>
                </label>
              </div>
            </div>

            <div *ngIf="selectedPaymentMethod === 'credit_card' || selectedPaymentMethod === 'debit_card'" class="card-fields">
              <div class="form-group">
                <label for="cardNumber">Card Number *</label>
                <input
                  type="text"
                  id="cardNumber"
                  formControlName="cardNumber"
                  [class.error]="cardNumber?.invalid && cardNumber?.touched"
                  placeholder="1234 5678 9012 3456"
                  maxlength="16"
                >
                <div *ngIf="cardNumber?.invalid && cardNumber?.touched" class="error-message">
                  <div *ngIf="cardNumber?.errors?.['required']">Card number is required</div>
                  <div *ngIf="cardNumber?.errors?.['pattern']">Please enter a valid 16-digit card number</div>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="cardExpiry">Expiry Date *</label>
                  <input
                    type="text"
                    id="cardExpiry"
                    formControlName="cardExpiry"
                    [class.error]="cardExpiry?.invalid && cardExpiry?.touched"
                    placeholder="MM/YY"
                    maxlength="5"
                  >
                  <div *ngIf="cardExpiry?.invalid && cardExpiry?.touched" class="error-message">
                    <div *ngIf="cardExpiry?.errors?.['required']">Expiry date is required</div>
                    <div *ngIf="cardExpiry?.errors?.['pattern']">Please use MM/YY format</div>
                  </div>
                </div>

                <div class="form-group">
                  <label for="cardCVC">CVC *</label>
                  <input
                    type="text"
                    id="cardCVC"
                    formControlName="cardCVC"
                    [class.error]="cardCVC?.invalid && cardCVC?.touched"
                    placeholder="123"
                    maxlength="4"
                  >
                  <div *ngIf="cardCVC?.invalid && cardCVC?.touched" class="error-message">
                    <div *ngIf="cardCVC?.errors?.['required']">CVC is required</div>
                    <div *ngIf="cardCVC?.errors?.['pattern']">Please enter a valid CVC</div>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label for="cardName">Name on Card *</label>
                <input
                  type="text"
                  id="cardName"
                  formControlName="cardName"
                  [class.error]="cardName?.invalid && cardName?.touched"
                  placeholder="Enter name as shown on card"
                >
                <div *ngIf="cardName?.invalid && cardName?.touched" class="error-message">
                  Name on card is required
                </div>
              </div>
            </div>
          </section>

          <!-- Order Notes -->
          <section class="form-section">
            <h2>ğŸ“ Order Notes</h2>
            <div class="form-group">
              <label for="orderNotes">Additional Instructions (Optional)</label>
              <textarea
                id="orderNotes"
                formControlName="orderNotes"
                placeholder="Any special instructions for your order..."
                rows="3"
              ></textarea>
            </div>
          </section>
        </div>

        <!-- Right Column - Order Summary -->
        <div class="summary-column">
          <div class="order-summary-card">
            <h3>Order Summary</h3>
            
            <!-- Cart Items -->
            <div class="checkout-items">
              <div *ngFor="let item of cartItems" class="checkout-item">
                <div class="item-image">
                  <img
                    [src]="item.product?.imageUrl || '/assets/images/placeholder-product.jpg'"
                    [alt]="item.product?.name"
                  />
                </div>
                <div class="item-details">
                  <h4>{{ item.product?.name }}</h4>
                  <p class="item-quantity">Qty: {{ item.quantity }}</p>
                  <p class="item-price">${{ (item.product?.price || 0) * item.quantity | number:'1.2-2' }}</p>
                </div>
              </div>
            </div>

            <!-- Price Breakdown -->
            <div class="price-breakdown">
              <div class="price-row">
                <span>Subtotal ({{ cartItemCount }} items):</span>
                <span>${{ cartSubtotal | number:'1.2-2' }}</span>
              </div>
              
              <div class="price-row">
                <span>Shipping:</span>
                <span *ngIf="shippingCost === 0" class="free-shipping">FREE</span>
                <span *ngIf="shippingCost > 0">${{ shippingCost | number:'1.2-2' }}</span>
              </div>
              
              <div class="price-row">
                <span>Tax (8.5%):</span>
                <span>${{ taxAmount | number:'1.2-2' }}</span>
              </div>
              
              <div class="price-divider"></div>
              
              <div class="price-row total-row">
                <strong>Total:</strong>
                <strong>${{ grandTotal | number:'1.2-2' }}</strong>
              </div>
            </div>

            <!-- Shipping Notice -->
            <div *ngIf="shippingCost === 0" class="shipping-notice success">
              ğŸ‰ You qualify for free shipping!
            </div>
            <div *ngIf="shippingCost > 0" class="shipping-notice info">
              Add ${{ (50 - cartSubtotal) | number:'1.2-2' }} more for free shipping
            </div>

            <!-- Submit Button -->
            <button
              type="submit"
              [disabled]="isSubmitting || checkoutForm.invalid"
              class="place-order-btn"
            >
              {{ isSubmitting ? 'Placing Order...' : 'Place Order' }}
            </button>

            <!-- Security Badges -->
            <div class="security-badges">
              <div class="security-badge">ğŸ”’ Secure Checkout</div>
              <div class="security-badge">âœ… SSL Encrypted</div>
              <div class="security-badge">ğŸ›¡ï¸ Money Back Guarantee</div>
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>
</div>